<!DOCTYPE html>
<html>
<head>
    <title>Sign-In Fix</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 40px auto; padding: 20px; background: #f8f9fa; }
        .box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #list { margin-top: 20px; }
        .entry { background: white; padding: 10px; margin-top: 10px; border-left: 5px solid #007bff; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        #status { font-size: 12px; margin-top: 10px; text-align: center; }
    </style>
</head>
<body>

    <div class="box">
        <h3>Sign In</h3>
        <input type="text" id="fn" placeholder="First Name">
        <input type="text" id="ln" placeholder="Last Name">
        <input type="number" id="age" placeholder="Age">
        <textarea id="job" placeholder="Your Ambition"></textarea>
        <button id="btn" onclick="saveData()">Submit</button>
        <div id="status"></div>
    </div>

    <div id="list">
        <h4>People:</h4>
        <div id="entries">Loading...</div>
    </div>

    <script>
        // Use the API version of your link
        const API_URL = "https://jsonblob.com/api/jsonBlob/019c2a6d-12fe-7c29-8905-d85cc566029c";

        async function loadData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("Could not read list");
                const data = await response.json();
                render(data);
                return data;
            } catch (e) {
                console.log("Load Error:", e);
                document.getElementById('entries').innerHTML = "List is empty or error loading.";
                return [];
            }
        }

        function render(data) {
            const html = data.map(p => `
                <div class="entry">
                    <b>${p.fn} ${p.ln}</b> (${p.age})<br>
                    <span>${p.job}</span>
                </div>
            `).join('');
            document.getElementById('entries').innerHTML = html || "No entries yet.";
        }

        async function saveData() {
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            
            const person = {
                fn: document.getElementById('fn').value,
                ln: document.getElementById('ln').value,
                age: document.getElementById('age').value,
                job: document.getElementById('job').value
            };

            if (!person.fn || !person.age) return alert("Fill out the name and age!");

            btn.disabled = true;
            status.innerText = "Processing...";

            try {
                // 1. Get current list
                const currentData = await loadData();
                
                // 2. Add new person
                currentData.push(person);

                // 3. Save to Cloud
                const response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(currentData)
                });

                if (response.ok) {
                    status.innerText = "Success!";
                    render(currentData);
                    document.querySelectorAll('input, textarea').forEach(i => i.value = '');
                } else {
                    throw new Error("Server rejected the save");
                }
            } catch (e) {
                console.error("Save Error:", e);
                status.innerText = "Error: " + e.message;
            } finally {
                btn.disabled = false;
            }
        }

        loadData();
    </script>
</body>
</html>
