<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–¢–†–û–ô–ö–ê –î–û–ú–ê üè† –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï</title>
    <style>
        body {
            margin: 0; padding: 0; font-family: 'Arial Black', Gadget, sans-serif;
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), 
                        url('https://i.ytimg.com/vi/j2nIMEMgcxQ/maxresdefault.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: white; height: 100vh; overflow: hidden;
        }

        .split-screen { display: flex; height: 100vh; width: 100%; }
        
        .left-side {
            flex: 1.2; background: rgba(0,0,0,0.6); border-right: 5px solid #f39c12;
            padding: 30px; overflow-y: auto; box-sizing: border-box;
        }

        .right-side {
            flex: 1; display: flex; justify-content: center; align-items: center; padding: 30px;
        }

        #full-screen-list {
            display: none; height: 100vh; width: 100%; overflow-y: auto; 
            padding: 40px 20px; box-sizing: border-box; text-align: center;
        }

        .title { color: #f39c12; text-shadow: 2px 2px 0px #000; margin-bottom: 25px; text-transform: uppercase; }

        .card { 
            background: #f4f4f4; color: #333; padding: 30px; border-radius: 12px; 
            border: 5px solid #f39c12; width: 100%; max-width: 380px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
        }

        input, select { 
            width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #ccc; 
            border-radius: 8px; font-size: 16px; box-sizing: border-box; font-family: sans-serif;
        }

        button { 
            width: 100%; padding: 18px; background: #f39c12; color: #000; 
            border: none; border-radius: 8px; font-weight: 900; cursor: pointer; font-size: 18px;
            text-transform: uppercase; transition: 0.2s;
        }
        button:hover:not(:disabled) { background: #e67e22; transform: translateY(-2px); }
        button:disabled { background: #95a5a6; cursor: not-allowed; }

        .team-count { 
            background: #f39c12; color: #000; padding: 10px 20px; border-radius: 8px; 
            font-weight: 900; margin-bottom: 20px; display: inline-block;
        }

        .worker-card { 
            background: rgba(44, 62, 80, 0.95); padding: 15px; margin-bottom: 15px; 
            border-radius: 10px; border-left: 8px solid #f39c12; text-align: left;
        }
        .worker-card b { color: #f39c12; font-size: 18px; text-transform: uppercase; display: block; }
        .worker-card .task { margin: 8px 0 0 0; color: #fff; font-size: 15px; border-top: 1px dashed #555; padding-top: 8px; }

        #status { margin-top: 10px; font-weight: bold; color: #f39c12; font-size: 14px; }

        @media (max-width: 850px) {
            .split-screen { flex-direction: column; overflow-y: auto; }
            .left-side { height: 40%; flex: none; border-right: none; border-bottom: 5px solid #f39c12; }
            body { overflow: auto; }
        }
    </style>
</head>
<body>

    <div id="login-screen" class="split-screen">
        <div class="left-side">
            <h2 class="title" style="font-size: 22px;">üõ† –ë–†–ò–ì–ê–î–ê –í –°–ë–û–†–ï:</h2>
            <div id="side-list-area">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="right-side">
            <div class="card">
                <h1 style="margin:0 0 15px 0; font-size: 24px;">–í–ó–Ø–¢–¨ –ó–ê–î–ê–ß–£</h1>
                <input type="text" id="fn" placeholder="–ò–º—è">
                <input type="text" id="ln" placeholder="–§–∞–º–∏–ª–∏—è">
                <input type="number" id="age" placeholder="–í–æ–∑—Ä–∞—Å—Ç">
                
                <label style="font-size: 12px; font-weight: bold; display: block; text-align: left; margin-top: 10px;">–í–´–ë–ï–†–ò –†–ê–ë–û–¢–£:</label>
                <select id="jobSelect">
                    <option value="–§—É–Ω–¥–∞–º–µ–Ω—Ç">–§—É–Ω–¥–∞–º–µ–Ω—Ç</option>
                    <option value="–î–µ–∫–æ—Ä–∞—Ü–∏—è">–î–µ–∫–æ—Ä–∞—Ü–∏—è</option>
                    <option value="–ü—Ä–∏–≥–æ—Ç–æ–≤–∫–∞ –¥—Ä–æ–≤">–ü—Ä–∏–≥–æ—Ç–æ–≤–∫–∞ –¥—Ä–æ–≤</option>
                    <option value="–ü–ª–∞–Ω + –ü–æ–º–æ—â—å">–°–¥–µ–ª–∞—Ç—å –ø–ª–∞–Ω + –ø–æ–º–æ–≥–∞—Ç—å</option>
                </select>

                <button id="submitBtn" onclick="saveData()">–ó–ê–°–¢–û–õ–ë–ò–¢–¨ –ú–ï–°–¢–û</button>
                <div id="status"></div>
            </div>
        </div>
    </div>

    <div id="full-screen-list">
        <h1 class="title">–ü–õ–ê–ù –†–ê–ë–û–¢ üè†</h1>
        <div class="team-count" id="teamCount">–í –ö–û–ú–ê–ù–î–ï: 0 –ß–ï–õ–û–í–ï–ö</div>
        <div id="full-list-area" style="max-width: 800px; margin: 0 auto;"></div>
        <button onclick="location.reload()" style="max-width: 200px; background:#444; color:white; margin-top:30px;">–ù–ê–ó–ê–î</button>
    </div>

    <script>
        const API_URL = "https://api.npoint.io/ad618be876cb8968fb5c";
        
        // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–∞–±–æ—Ç
        const ALL_JOBS = ["–§—É–Ω–¥–∞–º–µ–Ω—Ç", "–î–µ–∫–æ—Ä–∞—Ü–∏—è", "–ü—Ä–∏–≥–æ—Ç–æ–≤–∫–∞ –¥—Ä–æ–≤", "–ü–ª–∞–Ω + –ü–æ–º–æ—â—å"];

        async function loadData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                return Array.isArray(data) ? data : [];
            } catch (err) { return []; }
        }

        function updateJobSelect(occupiedJobs) {
            const select = document.getElementById('jobSelect');
            const btn = document.getElementById('submitBtn');
            select.innerHTML = "";

            const availableJobs = ALL_JOBS.filter(job => !occupiedJobs.includes(job));

            if (availableJobs.length === 0) {
                select.innerHTML = '<option value="">–ú–ï–°–¢ –ù–ï–¢</option>';
                btn.disabled = true;
                btn.innerText = "–í–°–ï –ó–ê–ù–Ø–¢–´";
            } else {
                availableJobs.forEach(job => {
                    const opt = document.createElement('option');
                    opt.value = job;
                    opt.innerText = job;
                    select.appendChild(opt);
                });
            }
        }

        async function refreshPage() {
            const list = await loadData();
            const sideArea = document.getElementById('side-list-area');
            const fullArea = document.getElementById('full-list-area');
            
            // –°–æ–±–∏—Ä–∞–µ–º —Å–ø–∏—Å–æ–∫ —É–∂–µ –∑–∞–Ω—è—Ç—ã—Ö —Ä–∞–±–æ—Ç
            const occupied = list.map(worker => worker.goal);
            updateJobSelect(occupied);

            document.getElementById('teamCount').innerText = `–í –ö–û–ú–ê–ù–î–ï: ${list.length} –ß–ï–õ–û–í–ï–ö`;

            const html = list.slice().reverse().map(p => `
                <div class="worker-card">
                    <b>${p.fn} ${p.ln}</b>
                    <div style="font-size:13px; color:#bdc3c7;">–í–æ–∑—Ä–∞—Å—Ç: ${p.age}</div>
                    <div class="task"><strong>–†–ê–ë–û–¢–ê:</strong> ${p.goal}</div>
                </div>
            `).join('');

            sideArea.innerHTML = list.length === 0 ? "–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ." : html;
            fullArea.innerHTML = html;
        }

        async function saveData() {
            const btn = document.getElementById('submitBtn');
            const fn = document.getElementById('fn').value.trim();
            const ln = document.getElementById('ln').value.trim();
            const age = document.getElementById('age').value;
            const goal = document.getElementById('jobSelect').value;

            if (!fn || !age || !goal) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å—ë!");

            btn.disabled = true;
            document.getElementById('status').innerText = "‚è≥ –ó–∞–ø–∏—Å—ã–≤–∞—é...";

            try {
                const currentList = await loadData();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –ø–æ–∫–∞ —Ç—ã –∑–∞–ø–æ–ª–Ω—è–ª, –∫—Ç–æ-—Ç–æ —É–∂–µ –∑–∞–Ω—è–ª —Ä–∞–±–æ—Ç—É
                if (currentList.some(w => w.goal === goal)) {
                    alert("–≠—Ç—É —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–Ω—è–ª–∏! –í—ã–±–µ—Ä–∏ –¥—Ä—É–≥—É—é.");
                    location.reload();
                    return;
                }

                currentList.push({ fn, ln, age, goal });
                await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentList)
                });

                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('full-screen-list').style.display = 'block';
                document.body.style.overflow = 'auto';
                refreshPage();
            } catch (err) {
                alert("–û—à–∏–±–∫–∞! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.");
                btn.disabled = false;
            }
        }

        refreshPage();
    </script>
</body>
</html>
